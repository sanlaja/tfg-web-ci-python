{% extends "base.html" %}

{% block title %}Historial Â· Simulador{% endblock %}

{% block content %}
<section class="page-header">
  <h1>Historial de an&aacute;lisis</h1>
  <p class="muted">
    Consulta an&aacute;lisis anteriores, filtra por fecha o ticker y exporta los resultados en CSV.
  </p>
</section>

<section class="card">
  <div class="card-section">
    <div class="form-grid">
      <div class="field">
        <label class="muted" for="his-ticker">Ticker</label>
        <input id="his-ticker" placeholder="Ticker" />
      </div>

      <div class="field">
        <label class="muted" for="his-desde">Desde</label>
        <input id="his-desde" type="date" />
      </div>

      <div class="field">
        <label class="muted" for="his-hasta">Hasta</label>
        <input id="his-hasta" type="date" />
      </div>

      <div class="field">
        <label class="muted" for="his-per-page">Por p&aacute;gina</label>
        <select id="his-per-page">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
    </div>

    <div class="actions-row">
      <div class="actions-row__left">
        <button id="his-filtrar" class="btn btn-primary">Filtrar</button>
        <button id="his-prev" class="btn btn-outline">Anterior</button>
        <button id="his-next" class="btn btn-outline">Siguiente</button>
        <button id="his-export" class="btn btn-ghost">Exportar CSV</button>
        <button id="his-share" class="btn btn-ghost" title="Copiar URL con filtros">Copiar URL</button>
      </div>
      <span id="his-info" class="muted"></span>
    </div>
  </div>

  <div class="card-section table-wrapper">
    <table class="data-table">
      <thead>
        <tr>
          <th data-sort-his="timestamp">Fecha</th>
          <th data-sort-his="ticker">Ticker</th>
          <th data-sort-his="importe_inicial">Importe</th>
          <th data-sort-his="horizonte_anios">Horizonte</th>
          <th data-sort-his="puntuacion">Puntuaci&oacute;n</th>
          <th>Resumen</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="his-tbody"></tbody>
    </table>
  </div>
</section>

<div class="modal-backdrop" id="modal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal__header">
      <h2 id="modal-title">Observaciones</h2>
      <button class="btn btn-ghost" id="modal-close" aria-label="Cerrar">Cerrar</button>
    </div>
    <div id="modal-body" class="modal__body"></div>
  </div>
</div>
<div id="modalBacktest" class="modal hidden">
  <div class="modal__content">
    <button class="modal__close" id="modalBacktestClose">&times;</button>
    <h3 id="mb_titulo">Resumen de la inversi&oacute;n</h3>
    <div class="modal__body">
      <ul class="kv">
        <li><strong>Ticker:</strong> <span id="mb_ticker"></span></li>
        <li><strong>Periodo:</strong> <span id="mb_periodo"></span></li>
        <li><strong>Inversi&oacute;n inicial:</strong> <span id="mb_inv_ini"></span></li>
        <li><strong>Valor final:</strong> <span id="mb_valor_final"></span></li>
        <li><strong>PnL (importe):</strong> <span id="mb_pnl_abs"></span></li>
        <li><strong>PnL (%):</strong> <span id="mb_pnl_pct"></span></li>
        <li><strong>Precio inicial (ajustado):</strong> <span id="mb_p0a"></span></li>
        <li><strong>Precio final (ajustado):</strong> <span id="mb_p1a"></span></li>
        <li><strong>Variaci&oacute;n ajustada:</strong> <span id="mb_vara"></span></li>
        <li><strong>Precio inicial (sin ajustar):</strong> <span id="mb_p0"></span></li>
        <li><strong>Precio final (sin ajustar):</strong> <span id="mb_p1"></span></li>
        <li><strong>Variaci&oacute;n sin ajustar:</strong> <span id="mb_var"></span></li>
        <li><strong>Precio actual:</strong> <span id="mb_now"></span></li>
        <li><strong>Dividendos en periodo:</strong> <span id="mb_div"></span></li>
      </ul>
      <div class="modal__actions">
        <a id="mb_csv_adj" class="btn" target="_blank">Descargar CSV (ajustado)</a>
        <a id="mb_csv_raw" class="btn btn--sec" target="_blank">Descargar CSV (sin ajustar)</a>
      </div>
      <div id="mb_notes" class="notes"></div>
    </div>
  </div>
</div>

{% endblock %}

